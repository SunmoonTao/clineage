import os
import re
import pysam
from django.conf import settings
from collections import defaultdict
from collections import Counter
from amplicons_handling.primers_insertion import create_primers_in_db
from amplicons_handling.positioning import insertion_plates_to_db
from amplicons_handling.create_targets import proccess_input_target_file


input_file =  '/net/mraid11/export/data/dcsoft/home/Ofir/cathy.snps.hg19.tab'
input_name = 'Cathy_SNP'
output_name = 'Cathy_Primers'
bowtie2_index = '/home/mint/bowtie/bowtie2_index/hg19'
is_tails = 1
xls_name = ("PrimerOrder{}.xls".format(str(output_name)))
no_tails_te_type, tails_te_type = TargetEnrichmentType.objects.all()
if is_tails:
    te_type = tails_te_type
else:
    te_type = no_tails_te_type
name_list = ['C12orf48','KCNJ5','ATM','PRKCQ','KCNJ6','TTN','PHLPP2','PCDH17','KDR','MYD88','CACNA1B','IFNAR2','CCDC18','MTOR','FMNL3','LCP1','SLC25A45','SIM1','ARHGEF10','RALYL','TLN2','KLHL25']
rv_list = ['CCGTACAATCTATTCTGTGAATC','GTTGTTGGAAAACATGAGGG','CTTCTTAAAATACTGCTCACCTG','TAATGAGTACCTGGAATGTTACA','GACCTTAGGAATTCCCACATT','CAGTTTGGTAAGTTTCTCAATCA','AAGTAAACAGAGAAAGGGATCAT','GGGTCGATCTCAAACAGGTG','TCTAGGATTTTTCCAAGTTGGTA','GAAGTACATGGACAGGCAGA','ATTTCATCCTAGGGGTGCAG','ATTTCCTTTCAAAAGAGACAGTC','AAGATTCATTTCACTCAACAGAG','GTAGTCTCAAGCAGATGTTAATG','GATCTTCAGAATTTTCTTAGCCT','CTTCACCTTCCATCTAGTCTTC','CCTCCTTCCTCTTGTGAATATAA','CTAGGTGTCAGACGGCTGTC','AATCACTATGAAGTACTAGGTGG','TATGAACAATAACGTGAGATCCA','GTCTTTGAGACTGAAGAGAACTT','GGACTTTGCCTACTCCTCAC']
fw_list = ['TATCATGTAATTCCTTTCCCCTT','ATTTGGTGGCTCATTGCTTATAT','GCATTATGCTAGGATAGTTTCC','GATTAAGAAGACGCAACAAAATG','TTTAAAATGAGCATCTATCCCAC','ATACCTGTATGTTGTGTCCTTTA','GACAACAGCTGAAAGAGAAAAA','CTTTTGAGTTCAAGGTGCTTG','CCCAGTCAGTTTTCATTAATCAT','CTTTTTGTGTGAGTGAATGTGT','GATTGGAGAGCTTGGTATTTCT','TGGAATAGCATTAGCAATGAAAA','TTAAAGCTTGACTTACTTGGAAC','AATGCGAGGAAGAAAAACAATC','GATTCCCATTTCCATCTTCATTG','AGAATTCAAGTTCCAAGTTTCAA','ACTTTACTTACTGGGATTCTGG','GAGAATTTAGGTGGGCCCAG','CCCACATGGAATTCTAAAGTTTT','TGTTTAAGGATTAAAGCAAGGAG','ACTACCGATAGTGAGCTCCT','CTTCACCCACTGGAGGATGG']

obj_list = proccess_input_target_file(input_file)
chosen_target_primers = defaultdict(lambda: defaultdict(str))
for i, target_id in enumerate(name_list):
    name_id = Target.objects.get(name=target_id)
    chosen_target_primers[name_id.pk]['LEFT'] = fw_list[i]
    chosen_target_primers[name_id.pk]['RIGHT'] = rv_list[i]

ptf, ptr = PrimerTail.objects.all()
te_list = create_primers_in_db(chosen_target_primers, te_type, pf_tail=ptf, pr_tail=ptr)
pairs_plates, stk_fw_plates, stk_rv_plates = insertion_plates_to_db(te_list)